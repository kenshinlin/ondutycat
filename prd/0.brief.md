# Dod Platform

## 背景

各种线上系统会有监控告警，告警需要值班人员处理，我希望做一个dod Agent，实现 AI 处理告警。

## 流程流程

1）产生告警、AI 处理告警
线上系统发生异常 --> 触发告警 --> 告警推送到 dod agent api server --> dod agent 收到告警，找到合适的 Skill 进行处理（可能会调用工具）--> agent 得出结论，是否真实系统异常 --> 推送结论到 IM 工具

如找不到匹配的 Skill，则开启一个 plan agent 自主调用工具进行排查

2）Skill 录入
登录 dod platform，打开 Skill 模块，业务人员可以录入 Skill, Skill 是指某类问题出现时的排除思路，表单项：解决什么问题、SOP

AI 如何匹配到 Skill：

- 通过语义匹配
- 人工绑定告警和 SOP

3）工具注册，有两种形式：

- 配置 MCP
- 写代码（提示词生成代码，或手写）

## 核心功能

1）接收告警
开放一个 webhook 可以接受告警，告警进来先入库，后有两个去处：

- 给 agent 处理
- 转发到 IM 群（支持 slack、lark），webhook带有一个receiver_im 参数，系统根据这个receiver_im将告警转发到对应群

过程如下：

```
Webhook 带参数 → /api/alerts?receiver_id=1&tenant_id
                                    ↓
                     查询 im_receivers 表匹配 receiver_im
                                    ↓
                     获取 bot_token/webhook_url 和 destination_id
                                    ↓
                     发送告警到 Slack/Lark 群组

```

2）agent 处理告警

- 寻找合适的 Skill，使用 Skill 进行分析
- 进行工具调用
- 使用 langchain 框架实现

3）对接IM工具（支持lark、slack）

4）多租户

4）告警信息管理，核心页面有：

- 查看告警记录
- 查看 issue 列表，可以查看 AI 处理
- 查看和录入 Skill
- 查看 Tool
- 自定义Tool 功能页面
  - 支持填写 MCP
  - 支持输入 JS 代码，所以要提供沙箱环境
- 配置页面，如配置 lark, slack API key

## 参考：

1. Skill 在langchain agent中的实现：https://docs.langchain.com/oss/javascript/langchain/multi-agent/skills-sql-assistant
2. Tool 在langchain agent中的使用：https://docs.langchain.com/oss/javascript/langchain/tools
3. MCP 适配langchain Tool：https://docs.langchain.com/oss/javascript/langchain/mcp
